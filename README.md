# DY_CAR
Shanghai Deyan  Electronic Technology Co., Ltd.
May 3
Be familiar with the IAR environment, import the MSP432 SDK routines and compile, download the board test, use the TI XDS emulator and set the location where the emulator is installed. Import the Empty project template in the SDK. This template integrates all the 432 driver functions and APIs, and implements corresponding functions directly in the main function. It is very convenient.
Speed ​​reducer motor speed measurement program consider using timer and capture device to test, because the encoder output signal is a square wave pulse, we can regularly measure the number of pulses in 1s and then according to the motor speed reduction ratio and no load speed, can determine the motor speed.
May 4
IAR can't enter Debug without Download mode. Debugging window fails to appear. This problem has been unloaded or reloaded yesterday. If you can't debug it, you won't be able to bring up the Terminal/IO window. Only this window can see the printed information, so if it doesn't work Consider using CCS to try it out.
CCS can not Debug, there have been two problems: 1, Load Programmer Error The revised header file of the main file to solve this problem, but then appeared 2, can not debug into this issue, so give up the CCS to debug.
IAR can directly copy empty templates into the workspace, so it is convenient, but it can't be debugged, and it doesn't know why.
There are many routines in the MSP432SDK. These routines can be used directly in their own workspace, so it is very convenient.
Update: CCS did not use Debug before using the example of Ginger, but IAR can download but not debug.
May 7
1. Solved the problem that IAR could not debug before. Now it can print and print out Printf information when debugging and debugging.
2. IAR can not find the .c file when directly importing the official routine. The reason is that the SDK is not configured for the environment. The specific solution is: tools->configure Custom Argument Variable->Global->import You install the SDK The location of the header file in the general SDK is on the C drive by default. Therefore, you need to check whether each configuration file corresponds to your SDK path. If not, change the path to your installation path.
3. Count the pulse signal of the motor with E401Y external interrupt and watchdog timer interrupt. There are two problems: 1. How to time out the watchdog timer interrupt and print it out and observe it. 2. Counting The rising edge and falling edge of the count are counted at the same time. How to match this count value with the watchdog timer's time, then print out.
May 8
1. It can test the number of signals of the gear motor in a circle. The signal number is: the reduction ratio * the number of signals of the motor's lap.
A watchdog timer is used, and an interrupt is generated for 1 second. The signal capture uses the BOTHEDGES serial port.
2. Use the QEI motor module that comes with the MSP432E401Y and use the QHA and QHB channels to count the pulses of the motor. QEI comes with speed calculation module, the number of calculations (COUNT) for the total number of rising and falling edges, and then use the QEI timer interrupt to interrupt the count 10ms, and then print out. The motor has 11 signals in one revolution and the reduction ratio is 46. The speed calculation formula is: RPM = (COUNT/4)*60/(46*11).
May 9
1. The PWM test has been completed and the PWM generator generated by the E401Y is used to generate the PWM waveform.
2. Investigate the PID algorithm, understand the principle of PID control, compare the characteristics of the positional PID and the incremental PID algorithm, and select one of them for debugging. Incremental PID operation is relatively simple, and it does not need to be accumulated in the formula. It is only related to the current beat and the error of the previous two beats. The output of the positional PID control is related to the entire past state. Accumulated errors are used, and the cumulative error is greater.
3. When using incremental PID, set the value of P/I/D according to the current speed to calculate. When returning the PID value, this value cannot be printed out in the QEI interrupt.
May 10
1, has been resolved based on the current speed, calculate the PID value and return and print out, using the control variable method, first set P = 1, I = 0, D = 0, for debugging.
2. Problem: PWM and motor speed cannot be synchronized, either only the speed and PID values ​​are displayed, or the PWM can output, but the two cannot be displayed synchronously.
Has been resolved: One of the PWM interrupt service enable switch name open error, resulting in the program does not work properly.
3. When debugging the PID, when the oscilloscope is used to test the PWM, the PWM output is not the same when printed out or not printed. The reason may be that the output of the PWM is affected when printing.
4, do not use printf to view the speed and PID and other information, using live watch window to observe the value of the variable in real time, but only global variables, local variables can not be observed.
May 11
1. The basic idea of ​​adjusting PID is:
a) First determine the parameter P, set I and D to 0, so that the PID is purely proportional adjustment, and gradually increase the proportional coefficient P from 0 to make it oscillate, and in turn adjust to make the oscillation disappear, record this without oscillation The proportional gain factor P is worth 60%-70%.
b) Fixed parameter P does not change. Adjust I parameter and set D parameter to 0. The same method should set a larger value first. When oscillation occurs, decrease it, and then increase it. Take 150%-180% when not oscillating. Finalize the I parameter.
c) The same applies to the D parameter, which is the same as the P and I parameters.
2. The PID value returned after PID debugging is used as the basis for adjusting the PWM duty cycle. When the PID value is positive, it indicates that the speed is greater than the set value. In this case, the duty cycle should be adjusted smaller. If the PID value is negative, it means that the speed is less than the set value and the duty cycle needs to be increased to make the speed reach the set value. Then use PWM to stabilize the speed near the set value.
May 14
1. UART has been debugged to send and receive strings, using the RX-> PA0, TX-> PA1. Send string can display its input value on the serial assistant.
2. Prepare the PID program before the serial port program is combined. The serial port controls the speed of the car. The specific tasks are:
a) We use the serial port assistant to send a string, an array of characters in the MCU, store the input speed in this character array, and print it on the serial port assistant to compare it with the actual speed.
b) After sending the speed value we set, we need the serial port to print the actual speed value adjusted by PID through the serial port. The actual speed can also exist in an array. This array is displayed on the serial port assistant via the serial port.
May 15
1. The combination of serial port output and PID program has been completed, the speed value of the input is printed out, and the current speed value is displayed. Since the interrupt of QEI is triggered once every 10ms, an accumulator is used, plus one 10ms, added to 100. Is 1s, every second to use the serial port to display the current speed. The set value is the PID reference value.
2. The conversion between character arrays and integers uses two functions. One is to convert the string to integer: atoi(), and the other is to convert the integer to character array using Sprintf(). Format an integer as a string.
3. The middle of the serial port assistant appears above the current speed is hexadecimal, because one of the functions UARTSend (uint8_t * pui8Buffer, uint32_t ui32Count) behind the ui32Count is how many hexadecimal meaning, before 16, should be 10 .
4. Each time the serial port is transferred, you need to clear the character array. Use the memset() function to clear the character array.
5. The task that needs to be done now is to adjust the PID so that the appropriate PWM output will control the speed near the input value.
May 16
completed:
1. Several serial port debugging tools were tried. The serial port hunter was selected as the PID controller's host computer. The current speed was output to the serial port hunter through the serial port, and the waveform was observed.
2. Change COM port, delete the default COM port configuration information of the registry, you can change the COM port.
3. Adjust the PID parameter and set the speed value to stabilize it near this value.


May 17
1. Adjusted the PID algorithm and debugged the parameters of better P and I. This time the adjustment is very large. The value after PID calculation can be used to adjust the duty cycle of pwm. The specific operation is as follows:
a) When P parameters are adjusted, the parameters of I and D are all set to 0. The effect of P parameter is to reflect the deviation of the system proportionally, and the effect of proportional adjustment is to immediately produce adjustment effect to reduce the deviation. The large proportional effect can speed up the adjustment and reduce the error. However, if the proportional adjustment is too large, the stability of the system will be degraded and the instability of the system may be caused. However, P cannot eliminate the static error (the difference between the set value and the actual value), so it can only be eliminated by the integral I.
b) When adjusting the I parameter, we set P and D to 0. If I overshoot occurs during the assembly, we will need to turn down the I parameter. PID = Ki*(setpoint(set speed)-current(now Speed)). At this time, the value of pid can be added to the original pwm duty cycle. The duty cycle is adjusted by the size of the PID. When the difference between the actual speed and the set value is the smallest, PWM should be the best at this time. Duty cycle.
2. The speed value sent through the serial port is completed, and the PID adjusts to the sending value. There are three fluctuations in the value. The possible cause is the error caused by the motor's accuracy.
